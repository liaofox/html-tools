<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‡½æ•°å›¾åƒæŸ¥çœ‹å™¨</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background: #f5f5f5;
            margin: 0;
            padding: 20px;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
        .graph-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .graph-canvas {
            width: 100%;
            height: 500px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        .back-button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }
        .function-info {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="graph-header">
            <h1>ğŸ“ˆ å‡½æ•°å›¾åƒ</h1>
            <a href="scientific-calculator.html" class="back-button">â† è¿”å›è®¡ç®—å™¨</a>
        </div>
        
        <div class="function-info">
            <div id="function-expression">æ­£åœ¨åŠ è½½å‡½æ•°è¡¨è¾¾å¼...</div>
        </div>
        
        <div class="graph-canvas">
            <canvas id="graph-canvas"></canvas>
        </div>

        <div style="margin-top: 20px; padding: 15px; background: #f0f8ff; border-radius: 8px;">
            <h3>ğŸ“– ä½¿ç”¨è¯´æ˜</h3>
            <p>â€¢ å›¾åƒæ˜¾ç¤ºå‡½æ•°åœ¨ x = [-10, 10] èŒƒå›´å†…çš„å€¼</p>
            <p>â€¢ æ”¯æŒå¸¸è§æ•°å­¦å‡½æ•°ï¼šsin(x), cos(x), x^2, log(x) ç­‰</p>
            <p>â€¢ ä½¿ç”¨é¼ æ ‡æ»šè½®å¯ä»¥ç¼©æ”¾å›¾åƒ</p>
        </div>
    </div>

<script>
        // ä»URLå‚æ•°è·å–å‡½æ•°è¡¨è¾¾å¼
        const urlParams = new URLSearchParams(window.location.search);
        const functionExpr = urlParams.get('function') || 'sin(x)';
        const angleMode = urlParams.get('angleMode') || 'degrees';
        
        document.getElementById('function-expression').textContent = `å‡½æ•°ï¼š${functionExpr} (${angleMode === 'degrees' ? 'è§’åº¦æ¨¡å¼' : 'å¼§åº¦æ¨¡å¼'})`;
        
        // åˆå§‹åŒ–å›¾è¡¨
        const ctx = document.getElementById('graph-canvas').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: functionExpr,
                    data: [],
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    borderWidth: 2,
                    pointRadius: 0,
                    showLine: true,
                    fill: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        type: 'linear',
                        position: 'center',
                        min: -20,
                        max: 20,
                        title: {
                            display: true,
                            text: 'x'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'y'
                        }
                    }
                }
            }
        });
        
            // ç»˜åˆ¶å‡½æ•°å›¾åƒ - æ™ºèƒ½åæ ‡è½´è°ƒæ•´
            function plotFunction() {
                const xValues = [];
                const yValues = [];
                const step = 0.1;
                let yMin = Infinity;
                let yMax = -Infinity;
                
                // æ™ºèƒ½ç¡®å®šxè½´èŒƒå›´
                let xRange = 20; // é»˜è®¤èŒƒå›´
                
                // æ ¹æ®å‡½æ•°ç±»å‹åŠ¨æ€è°ƒæ•´xè½´èŒƒå›´
                if (functionExpr.includes('log') || functionExpr.includes('sqrt')) {
                    xRange = 10; // å¯¹æ•°å‡½æ•°å’Œå¹³æ–¹æ ¹å‡½æ•°èŒƒå›´å°ä¸€äº›
                } else if (functionExpr.includes('sin') || functionExpr.includes('cos')) {
                    xRange = 4 * Math.PI; // ä¸‰è§’å‡½æ•°èŒƒå›´å¤§ä¸€äº›
                } else if (functionExpr.includes('^') || functionExpr.includes('**')) {
                    xRange = 5; // å¹‚å‡½æ•°èŒƒå›´å°ä¸€äº›
                }
                
                // è®¡ç®—xè½´èŒƒå›´
                const xMin = -Math.abs(xRange);
                const xMax = Math.abs(xRange);
                
                for (let x = xMin; x <= xMax; x += step) {
                    try {
                        // æ›¿æ¢å‡½æ•°è¡¨è¾¾å¼ä¸­çš„å˜é‡
                        let expr = functionExpr.replace(/x/gi, `(${x})`);
                        
                        // å¤„ç†è§’åº¦æ¨¡å¼
                        expr = convertAngleMode(expr, angleMode);
                        
                        // æ›¿æ¢å…¶ä»–æ•°å­¦å‡½æ•°å’Œå¸¸æ•°
                        expr = expr
                            .replace(/Ï€/g, 'Math.PI')
                            .replace(/pi/g, 'Math.PI')
                            .replace(/e/g, 'Math.E')
                            .replace(/\^/g, '**')
                            .replace(/sqrt\(/g, 'Math.sqrt(')
                            .replace(/log\(/g, 'Math.log10(')
                            .replace(/ln\(/g, 'Math.log(')
                            .replace(/exp\(/g, 'Math.exp(');
                        
                        const y = eval(expr);
                        
                        if (typeof y === 'number' && isFinite(y)) {
                            xValues.push(x);
                            yValues.push(y);
                            
                            // æ›´æ–°yå€¼èŒƒå›´
                            if (y < yMin) yMin = y;
                            if (y > yMax) yMax = y;
                        }
                    } catch (e) {
                        continue;
                    }
                }
                
                // æ™ºèƒ½è°ƒæ•´yè½´èŒƒå›´
                let finalYMin, finalYMax;
                
                if (yMin === Infinity || yMax === -Infinity) {
                    // å¦‚æœæ²¡æœ‰æœ‰æ•ˆæ•°æ®ç‚¹ï¼Œä½¿ç”¨é»˜è®¤èŒƒå›´
                    finalYMin = -10;
                    finalYMax = 10;
                } else if (Math.abs(yMax - yMin) < 0.001) {
                    // å¦‚æœyå€¼èŒƒå›´éå¸¸å°ï¼ˆå¸¸æ•°å‡½æ•°ï¼‰
                    finalYMin = yMin - 1;
                    finalYMax = yMax + 1;
                } else {
                    // è®¡ç®—åˆç†çš„yè½´èŒƒå›´
                    const yRange = yMax - yMin;
                    const padding = yRange * 0.2; // 20%çš„padding
                    finalYMin = yMin - padding;
                    finalYMax = yMax + padding;
                }
                
                // ç¡®ä¿yè½´èŒƒå›´ä¸ä¼šå¤ªå¤§
                if (Math.abs(finalYMax - finalYMin) > 1000) {
                    finalYMin = -100;
                    finalYMax = 100;
                }
                
                // æ›´æ–°å›¾è¡¨æ•°æ®å’ŒèŒƒå›´
                chart.data.datasets[0].data = xValues.map((x, i) => ({x, y: yValues[i]}));
                chart.data.datasets[0].label = functionExpr;
                chart.options.scales.x.min = xMin;
                chart.options.scales.x.max = xMax;
                chart.options.scales.y.min = finalYMin;
                chart.options.scales.y.max = finalYMax;
                chart.update();
            }
        
            // é¡µé¢åŠ è½½æ—¶ç»˜åˆ¶
            setTimeout(plotFunction, 100);
            
            // ä¿®å¤è§’åº¦æ¨¡å¼å¤„ç†
            function convertAngleMode(expr, mode) {
                if (mode === 'degrees') {
                    return expr
                        .replace(/sin\(/g, 'Math.sin(Math.PI/180*')
                        .replace(/cos\(/g, 'Math.cos(Math.PI/180*')
                        .replace(/tan\(/g, 'Math.tan(Math.PI/180*')
                        .replace(/asin\(/g, 'Math.asin(')
                        .replace(/acos\(/g, 'Math.acos(')
                        .replace(/atan\(/g, 'Math.atan(');
                }
                return expr;
            }
    </script>
</body>
</html>